---
- name: Get PCIe Generation Information
  hosts: all
  become: yes
  tasks:
    - name: Retrieve PCIe information using lspci
      command: lspci -vvv
      register: lspci_output

    - name: Extract PCIe link capabilities
      set_fact:
        pcie_gen_info: "{{ lspci_output.stdout_lines | select('search', 'LnkCap') | list }}"

    - name: Display PCIe generation information
      debug:
        msg: "{{ pcie_gen_info }}"
      when: pcie_gen_info | length > 0

    - name: Handle case where no PCIe information is found
      debug:
        msg: "No PCIe generation information found."
      when: pcie_gen_info | length == 0

